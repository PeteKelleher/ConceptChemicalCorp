<?xml version="1.0"?>
<odoo>
    <data>
    	
    	       
        <template id="ia_cc_stock_delivery_slip_stock_view" inherit_id="stock.report_delivery_document">
        	<xpath expr="//t[@t-call='web.external_layout']" position="before">
          		<t t-set="is_expected_delivery_slip" t-value="True"/>
            </xpath>
            <xpath expr="//t/t/t[@name='partner_header']" position="replace">
            </xpath>
<!--            <xpath expr="//td[@t-if='o.origin']" position="replace">-->
<!--            </xpath>-->
<!--            <xpath expr="//tbody/tr/td[2][@name='td_sched_date']" position="replace">-->
<!--            </xpath>-->
			<xpath expr="//div/table[1]" position="replace">
				<table class="table table-sm">
                        <thead>
                            <tr>
                                <th><strong>Supplier Reference#</strong></th>
                                <th>
                                    <strong>Customer Requested Date</strong>
                                </th>
                                <th>
                                    <strong>Delivery Commitment Date</strong>
                                </th>
                                <th name="td_sched_date_h">
                                    <strong>Date Ordered</strong>
                                </th>
                                <th>
                                    <strong>Expected Date</strong>
                                </th>
                                <th>
                                    <strong>Incoterms</strong>
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>
                                    <span t-field="o.custom_partner_ref"/>
                                </td>
                                <td>
                                    <span t-field="o.scheduled_date" t-options="{&quot;format&quot;: &quot;dd/MM/yyyy&quot;}"/>
                                </td>
                                 <td>
                                    <span t-field="o.scheduled_date" t-options="{&quot;format&quot;: &quot;dd/MM/yyyy&quot;}"/>
                                </td>
                                <td name="td_sched_date">
                                    <span t-field="o.date_done" t-options="{&quot;format&quot;: &quot;dd/MM/yyyy&quot;}"/>
                                </td>
                                <td name="td_sched_date">
                                    <span t-field="o.scheduled_date" t-options="{&quot;format&quot;: &quot;dd/MM/yyyy&quot;}"/>
                                </td>
                                <td>
                                    <span t-field="o.custom_incoterm_id"/>
                                </td>
                            </tr>
                        </tbody>
                    </table>
			</xpath>
<!--            <xpath expr="//t/t/t[@t-if='not (o.move_lines and o.move_lines[0].partner_id) and o.partner_id']" position="replace">-->
<!--            </xpath>-->
			<xpath expr="//t/div/h2" position="replace">
				<h2 class="text-center">
                	Expected Delivery <span t-field="o.name"/>
                </h2>
			</xpath>
			
            <xpath expr="//t/t/div[@class='page']" position="before">
                <table width="100%">
<!--                    <div class="col-xs-4">-->
<!--                        <h3>Expected Delivery Slip</h3>-->
<!--                    </div>-->
					<tr>
	                    <td width="59.5%">
	<!--                        <t t-if="o.move_lines and o.move_lines[0].partner_id">-->
	<!--                                <strong>Customer:</strong>-->
	<!--                                <div t-field="o.move_lines[0].partner_id"-->
	<!--                                t-options='{"widget": "contact", "fields": ["address", "name", "phone"], "no_marker": True}'/>-->
	<!--                        </t>-->
								<t t-if="o.partner_id">
	                        	<strong>Deliver To:</strong>
	                                <div t-field="o.partner_id" 
	                                     t-options='{"widget": "contact", "fields": ["address", "name", "phone"], "no_marker": True}'/>
	                            </t>    
								<!--<t t-if="not (o.move_lines and o.move_lines[0].partner_id) and o.partner_id">
	                                <strong>Supplier address:</strong>
	                                <div t-field="o.partner_id"
	                                t-options='{"widget": "contact", "fields": ["address", "name", "phone"], "no_marker": True}'/>
	                        	</t>-->
	                    </td>
	                    <td width="30%" >
	                        <t t-if="o.picking_type_id.warehouse_id.partner_id">
		                                <strong>Warehouse Address:</strong>
		                                <div t-field="o.picking_type_id.warehouse_id.partner_id"
		                                t-options='{"widget": "contact", "fields": ["address", "name", "phone"], "no_marker": True}'/>
		                        </t>
	                    </td>
	                    <td width="11%">
	                    </td>
                    </tr>
                </table>
            </xpath>
<!--            <xpath expr="//th[@t-if='o.origin']/strong" position="replace">-->
<!--            </xpath>-->
<!--            <xpath expr="//tbody/tr/td[1][@t-if='o.origin']" position="replace">-->
<!--            </xpath>-->
			<xpath expr="//t/div/table[2]" position="replace">
				<table class="table table-sm mt48 table-custom" t-if="o.state!='done'">
                        <thead>
                            <tr>
                                <th><strong>Product Name</strong></th>
                                <th><strong>Pack Size</strong></th>
                               <!-- <th><strong>INCI Name</strong></th>-->
                                <th><strong>Batch Number</strong></th>
                                <th class="text-center"><strong>Unit Quantity</strong></th>
                                <th class="text-center"><strong>UOM</strong></th>
                                <th><strong>Number Packages</strong></th>
                                <th><strong>Gross Shipping Weight</strong></th>
                            </tr>
                        </thead>
                        <tbody>
                            <t t-set="lines" t-value="o.move_lines.filtered(lambda x: x.product_uom_qty)"/>
                            <tr t-foreach="lines" t-as="move"><t t-foreach="move.move_line_ids" t-as="move_line">
                                <td>
                                    <span t-field="move.product_id"/>
                                    <p t-if="o.picking_type_code == 'outgoing'">
                                        <span t-field="move.product_id.sudo().description_pickingout"/>
                                    </p>
                                    <p t-if="o.picking_type_code == 'incoming'">
                                        <span t-field="move.product_id.sudo().description_pickingin"/>
                                    </p>
                                </td>
                                <td>
                                	<span t-field="move.product_id.x_studio_field_JuQGN"/>
<!--                                	<span t-field="move.package_id.weight"/-->
                                </td>
                               <!-- <td> 
                                	<span t-field="move.product_id.x_studio_field_xYGHQ"/>
                                </td>-->
                                <td class="text-left">
                                		<span t-field="move_line.lot_id"/>
							    </td>
                                <td>
                                    <span t-field="move.product_uom_qty"/>
                                </td>
                                <td>
                                    <span t-field="move.product_uom"/>
                                </td>
                                <td>
                                	<t t-if="not move.product_uom_qty  or move.product_id.x_studio_field_JuQGN" >
                                		<span t-esc="'%0.01f'%((move.product_uom_qty / float(move.product_id.x_studio_field_JuQGN)))"/>
                                	</t>
                                </td>
                                <td class="text-right">
                                	<span t-esc="'%.1f'%move.product_id.weight"/>
                                </td>
                                </t>
                            </tr>
                        </tbody>
                    </table>
			</xpath>
            <xpath expr="//t/t/div/table[3]" position="replace">
            	<table class="table table-sm mt48" t-if="o.move_line_ids and o.state=='done'">
                        <t t-set="has_serial_number" t-value="o.move_line_ids.mapped('lot_id')" />
                        <thead>
                            <tr>
                                <th><strong>Product Name</strong></th>
                                <th><strong>Pack Size</strong></th>
                                <!--<th><strong>INCI Name</strong></th> -->
                                <th><strong>Batch Number</strong></th>
                              <!--  <th name="lot_serial" t-if="has_serial_number" groups="stock.group_lot_on_delivery_slip">
                                    Lot #
                                </th>-->
                                <th class="text-center"><strong>Unit Quantity</strong></th>
                                <th class="text-center"><strong>UOM</strong></th>
                                <th><strong>Number Packages</strong></th>
                                <th><strong>Gross Shipping Weight</strong></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr t-foreach="o.move_line_ids" t-as="move_line">
                                <td>
                                    <span t-field="move_line.product_id"/>
                                    <p t-if="o.picking_type_code == 'outgoing'">
                                        <span t-field="move_line.product_id.sudo().description_pickingout"/>
                                    </p>
                                    <p t-if="o.picking_type_code == 'incoming'">
                                        <span t-field="move_line.product_id.sudo().description_pickingin"/>
                                    </p>
                                </td>
                                <td>
                                	<span t-field="move_line.product_id.x_studio_field_JuQGN"/>
                                </td>
                               <!-- <td> 
                                	<span t-field="move_line.product_id.x_studio_field_xYGHQ"/>
                                </td>-->
                                <td class="text-left">
                                	<span t-field="move_line.lot_id.name"/>
							    </td>
                               <!-- <td  t-if="has_serial_number">
                                    <span t-field="move_line.lot_name"/>
                                     <span t-field="move_line.lot_id.name"/>
                                </td>-->
                                <td class="text-right">
                                    <span t-field="move_line.qty_done"/>
                                </td>
                                <td class="text-right">
                                    <span t-field="move_line.product_uom_id"/>
                                </td>
                                <td>
                                	<t t-if="move_line.qty_done &gt; 0.0 and float(move_line.product_id.x_studio_field_JuQGN) &gt; 0.0">
                                		<span t-esc="'%0.01f'%((move_line.qty_done / float(move_line.product_id.x_studio_field_JuQGN)))"/>
                                	</t>
                                </td>
                                <td class="text-right">
                                	<span t-esc="'%.1f'%move_line.product_id.weight"/>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <div>
	                    <div class="col-xs-6">
	                    	<!--<p><strong>Commitment Date:<span t-field="o.scheduled_date"/></strong></p>
	                    	<p><strong>Scheduled Date:<span t-field="o.scheduled_date"/></strong></p>-->
	                    </div>
	                    <div class="col-xs-6 clearfix">
	                    	<t t-set="final_total_package" t-value="0"/>
                        	<t t-set="total_qty" t-value="0"/>
                        	<t t-set="total_x_studio_field_JuQGN" t-value="0"/>
                        	<t t-set="total_gs_weight" t-value="0"/>
	                        <div id="total" class="row">
	                            <div t-attf-class="#{'col-4' if report_type != 'html' else 'col-sm-7 col-md-5'} ml-auto">
	                                <table class="table table-sm">
	                                   <!-- <tr class="border-black o_subtotal">
	                                        <td><strong>Total Quantity</strong></td>
	                                        <td class="text-right">
	                                            <span t-esc="sum(p_qty.product_uom_qty for p_qty in o.move_ids_without_package) "/>
	                                        </td>
	                                    </tr>-->
	                                    <tr>
	                                    	<td><font color="#875a7b"><b>Total Packages</b></font></td>
			                            	<td class="text-right">
			                            		<t t-foreach="o.move_ids_without_package" t-as="p_qty">
				                            		   <t t-if="p_qty.product_uom_qty &gt; 0.0 and float(p_qty.product_id.x_studio_field_JuQGN) &gt; 0.0">
				                            				<t t-set="total_qty" t-value="total_qty + p_qty.product_uom_qty"/>
				                            				<t t-set="total_x_studio_field_JuQGN" t-value="total_x_studio_field_JuQGN + float(p_qty.product_id.x_studio_field_JuQGN)"/>
				                            				<t t-set="final_total_package" t-value="final_total_package +((total_qty + p_qty.product_uom_qty) / (total_x_studio_field_JuQGN + float(p_qty.product_id.x_studio_field_JuQGN)))"/>
				                            	</t>
				                            	</t>
				                           		<t t-if="total_qty &gt;0.0 and total_x_studio_field_JuQGN &gt;0.0">
						                           <span t-esc="'%0.02f'%(final_total_package)"/>
											   </t>
			                            	</td> 
	                            		</tr>
	                            		<tr>
	                                    	<td><font color="#875a7b"><b>Total Gross Shipping Weights</b></font></td>
			                            	<td class="text-right">
			                            		<t t-foreach="o.move_ids_without_package" t-as="p_qty">
			                            		   <t t-if="p_qty.product_id.weight &gt; 0.0 and float(p_qty.product_id.x_studio_field_JuQGN) &gt; 0.0">
			                            				<t t-set="total_gs_weight" t-value="total_gs_weight +(p_qty.product_id.weight * (p_qty.product_uom_qty / float(p_qty.product_id.x_studio_field_JuQGN)))"/>
			                            		   </t>
			                            		</t>
			                            		<t t-if="total_gs_weight &gt; 0.0">
			                            			<span t-esc="'%0.02f'%(total_gs_weight)"/>
			                            		</t>
                                    		</td>
	                            		</tr>
	                                </table>
	                            </div>
	                        </div>
	                    </div>
                    </div>
            </xpath>
        </template>

        <template id="ia_cc_stock_delivery_slip_stock_delivery_view" inherit_id="delivery.report_delivery_document2">
              <xpath expr="//th[@t-if='o.shipping_weight']" position="replace">
                <th name="shipping_weight">Weight</th>
              </xpath>
              <xpath expr="//td[@t-if='o.shipping_weight']" position="replace">
                <td>
	                <span t-field="o.weight"/>
	                <span t-field="o.weight_uom_id"/>
	            </td>
              </xpath>
        </template>
    </data>
</odoo>
